$(document).ready(function () {
  // === 1. –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –Ω—É–∂–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º DOM ===
  const contactsList = $('#contacts-list');    // –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–ª–µ–≤–∞—è —Å–µ–∫—Ü–∏—è)
  const phoneInput = $('#phone-input');        // –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–ø—Ä–∞–≤–∞—è —Å–µ–∫—Ü–∏—è)
  const callBtn = $('#call-btn');              // –ö–Ω–æ–ø–∫–∞ "–ü–æ–∑–≤–æ–Ω–∏—Ç—å"
  const endBtn = $('#end-btn');                // –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
  const timerDisplay = $('#timer-display');    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–≤–æ–Ω–∫–∞ (–≤–Ω–∏–∑—É —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Å–µ–∫—Ü–∏–∏)
  const chatArea = $('#chat-area');            // –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è)

  // === 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ InputMask ===
  // –ú–∞—Å–∫–∞ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–æ–¥–∏—Ç—å –Ω–æ–º–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ: +7(XXX)XXX-XX-XX
  $('#phone-input').inputmask("+7(999)999-99-99");

  // === 3. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Å API jsonplaceholder ===
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è jQuery.ajax –¥–ª—è GET-–∑–∞–ø—Ä–æ—Å–∞ –ø–æ URL —Å –¥–∞–Ω–Ω—ã–º–∏ —é–∑–µ—Ä–æ–≤
  $.ajax({
    url: 'https://jsonplaceholder.typicode.com/users', // API
    method: 'GET',
    success: function (users) {
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      users.forEach(user => {
        // –ò–∑ –∏–º–µ–Ω–∏ —Å–æ–∑–¥–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã (–ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –∏–º—ë–Ω –∏ —Ñ–∞–º–∏–ª–∏–π)
        const initials = user.name
          .split(' ')           // –†–∞–∑–±–∏–≤–∞–µ–º –∏–º—è –Ω–∞ —Å–ª–æ–≤–∞
          .map(w => w[0])       // –ë–µ—Ä—ë–º –ø–µ—Ä–≤—É—é –±—É–∫–≤—É –∫–∞–∂–¥–æ–≥–æ
          .join('')             // –°–∫–ª–µ–∏–≤–∞–µ–º
          .toUpperCase()        // –î–µ–ª–∞–µ–º –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏
          .slice(0, 2);         // –¢–æ–ª—å–∫–æ 2 —Å–∏–º–≤–æ–ª–∞ (–µ—Å–ª–∏ –∏—Ö –±–æ–ª—å—à–µ)

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ ‚Äî li —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ div
        const item = $(`
          <li class="contact-item" data-phone="${user.phone}">
            <div style="display: flex; align-items: center;">
              <div class="avatar">${initials}</div> <!-- –ê–≤–∞—Ç–∞—Ä —Å –∏–Ω–∏—Ü–∏–∞–ª–∞–º–∏ -->
              <div>
                <strong>${user.name}</strong><br>
                <small>${user.email}</small>
              </div>
            </div>
          </li>
        `);

        // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM ‚Äî –≤ UL
        contactsList.append(item);
      });
    },
    error: function () {
      // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Äî –≤—ã–≤–æ–¥–∏–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ Toast
      toastr.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã.");
    }
  });

  // === 4. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç ===
  // - –ë–µ—Ä—ë—Ç—Å—è –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  // - –í—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ input
  // - –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Å–µ–∫—Ü–∏–∏
  contactsList.on('click', '.contact-item', function () {
    const number = $(this).data('phone');             // –ù–æ–º–µ—Ä –∏–∑ data-phone
    const name = $(this).find('strong').text();       // –ò–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞

    phoneInput.val(number);      // –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    chatArea.empty();            // –û—á–∏—â–∞–µ–º "—á–∞—Ç"

    // –î–æ–±–∞–≤–ª—è–µ–º –¥–≤–∞ —Ñ–∏–∫—Ç–∏–≤–Ω—ã—Ö "—Å–æ–æ–±—â–µ–Ω–∏—è", –±—É–¥—Ç–æ –±—ã –æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–∞
    chatArea.append(`<div class="message-other">–ü—Ä–∏–≤–µ—Ç, —è ${name}</div>`);
    setTimeout(() => {
      chatArea.append(`<div class="message-other">–ö–∞–∫ –¥–µ–ª–∞?</div>`);
    }, 1000); // –≤—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1 —Å–µ–∫—É–Ω–¥—É
  });

  // === 5. –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä —Ç–∞–π–º–µ—Ä–∞ —Å –ø–æ–º–æ—â—å—é EasyTimer ===
  const timer = new easytimer.Timer();

  // === 6. –ó–∞–ø—É—Å–∫ –∑–≤–æ–Ω–∫–∞ ===
  // - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –Ω–æ–º–µ—Ä –Ω–µ –ø—É—Å—Ç–æ–π
  // - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Toast
  // - –°—Ç–∞—Ä—Ç —Ç–∞–π–º–µ—Ä–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
  callBtn.on('click', function () {
    const number = phoneInput.val().trim(); // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã

    if (!number) {
      toastr.warning('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞!');
      return;
    }

    toastr.success(`üìû –ó–≤–æ–Ω–æ–∫ –Ω–∞ ${number}`); // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

    timer.reset(); // –°–±—Ä–æ—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    timer.start(); // –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ–∫—É–Ω–¥
    timer.addEventListener('secondsUpdated', function () {
      timerDisplay.text(timer.getTimeValues().toString());
    });
  });

  // === 7. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞ ===
  endBtn.on('click', function () {
    timer.stop(); // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞
    timerDisplay.text("00:00"); // –°–±—Ä–æ—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    toastr.info("‚ùå –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω"); // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  });

  // === 8. –ù–∞–±–æ—Ä —Ü–∏—Ñ—Ä —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ ===
  // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É —Å –∫–ª–∞—Å—Å–æ–º `.key`
  // —Ü–∏—Ñ—Ä–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞
  $('.key').on('click', function () {
    const digit = $(this).text();         // –ü–æ–ª—É—á–∞–µ–º —Ü–∏—Ñ—Ä—É —Å –∫–Ω–æ–ø–∫–∏
    const current = phoneInput.val();     // –¢–µ–∫—É—â–∏–π –≤–≤–æ–¥
    phoneInput.val(current + digit);      // –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—É
  });
});


